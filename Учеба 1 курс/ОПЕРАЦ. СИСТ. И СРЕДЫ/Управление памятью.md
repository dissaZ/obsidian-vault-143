[[ОСИС]] 28.11.25

# **Абстракция памяти**
Ранние программы работали напрямую с физической памятью. Это вызывало проблемы:
- ошибка в одной программе могла "уронить" всю систему
- программа могла читать и изменять память другой программы
- программе нужен был непрерывный блок памяти

## Решение - абстракция виртуальной памяти
ОС создает для каждой программы иллюзию, что у нее в распоряжении есть собственное, изолированное адресное пространство (виртуальная память), которое обычно больше, чем реальная физическая память ОЗУ.

- виртуальный адрес: адрес который использует программа
- физический адрес: адрес в реальной оперативной памяти

За перевод виртуальных адресов в физические  отвечает Memory management unit (MNU) - аппаратный компонент процессора, которым управляет ОС.

`wmic process where "name='notepad.exe'" get name, ProcessId, workingsetsize, pageFileUsage, VirtualSize`

В выводе колонки:
**Mem usage**: Примерное использование физической памяти.
Каждой процесс живет в своем собственном виртуальном адресном пространстве, изолированном от других

- WorkingSetSize - объем физ памяти в байтах используемой процессом
- VirtualSize - объем виртуальной памяти (байт)
- pageFileusage - объем памяти в файле подкачки (байт)

# Страничная организация памяти (paging)
- **виртуальная память** разбита на **страницы** (pages), типичный размер 4кб
- физическая память разбита на кадры (frames) того же размера.
ОС ведет таблицу для каждого процесса, которая отображает виртуальные страницы на физические кадры.

Преимущества:
- любую свободную страницу можно выделить любому процессу
- память выделяется и освобождается целыми страницами.
- не все страницы должны находиться в ОЗУ.

# Виртуальная память и подкачка
- активные страницы находятся в ОЗУ
- неактивные страницы могут быть вытеснены на диск
При обращении к странице, которой нет в ОЗУ, происходит Page fault (страничное прерывание). ОС находит нужную страницу на диске, загружает ее в озу и обновляет таблицу страниц

`wmic OS get TotalvisiblememorySize, freephysicalmemory, totalvirtualmemorysize, freevirtualmemory /value` можно понять сколько у нас отложено памяти под виртуальную и сколько занято в общем

Подкачка - это механизм управления памятью в операционной системе, при котором данные (страницы памяти или сегменты), не помещающиеся в оперативной памяти ОЗУ, временно перемещаются на специальное место на жестком диске или ssd, называемое файлом подкачки

1. Оперативная память ОЗУ работает очень быстро, но ее объем ограничен
2. когда запускается много программ или одна тяжелая программа, вся оперативная память может быть заполнена
3. чтобы освободить место в озу для новых задач, система берет редко используемые фрагменты данных из ОЗУ и записывает их в файл подкачки на диске.
4. освободившееся место в ОЗУ используется для активных программ.
5. Если позже системе снова понадобятся данные, которые были выгружены на диск, она подкачает их обратно в ОЗУ

perfmon /res - монитор ресурсов и производительности

# Сегментация
Делится на
- **страница** - фиксированный по размеру, бессмысленный блок
- **сегмент** - переменный по размеру, логически осмысленный блок

чаще используют гибридный подход - **сегментно-страничную организацию, где сначала память делится на сегменты, а уже каждый сегмент - на страницы

